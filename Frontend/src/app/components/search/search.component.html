<div class="search-container">
  <div class="search-form">
    <form (ngSubmit)="searchBuses()">
      <div class="search-inputs-row">
        <div class="input-group from-group">
          <label for="source">GOING FROM</label>
          <select id="source" [(ngModel)]="searchRequest.source" name="source" required>
            <option value="">Select source</option>
            <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
          </select>
        </div>

        <div class="swap-icon">
          <span (click)="swapCities()">⇄</span>
        </div>

        <div class="input-group to-group">
          <label for="destination">GOING TO</label>
          <select id="destination" [(ngModel)]="searchRequest.destination" name="destination" required>
            <option value="">Select destination</option>
            <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
          </select>
        </div>

        <div class="input-group date-group">
          <label for="journeyDate">JOURNEY DATE</label>
          <input 
            type="date" 
            id="journeyDate" 
            [(ngModel)]="searchRequest.journeyDate" 
            name="journeyDate"
            [min]="searchRequest.journeyDate"
            required>
        </div>

        <div class="input-group date-group">
          <label for="returnDate">RETURN DATE</label>
          <input 
            type="date" 
            id="returnDate" 
            name="returnDate"
            placeholder="Select date">
        </div>
      </div>

      <div class="trending-searches">
        <span class="trending-label">Trending Searches:</span>
        <span class="trending-item">Dhaka → Rajshahi</span>
        <span class="trending-item">Dhaka → Barisal</span>
        <span class="trending-item">Dhaka → Cox's Bazar</span>
        <span class="trending-item">Dhaka → Chittagong</span>
        <span class="trending-item">Dhaka → Chapainawabganj</span>
      </div>

      <div class="search-button-container">
        <button type="submit" class="btn btn-search" [disabled]="isLoading">
          {{ isLoading ? 'Searching...' : 'Search Bus' }}
        </button>
      </div>
    </form>
  </div>

  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Searching for available buses...</p>
  </div>

  <div *ngIf="!selectedBus && availableBuses.length > 0" class="results-section">
    <!-- Header Banner -->
    <div class="results-header">
      <div class="header-content">
        <div class="trip-info">
          <span class="trip-label">ONWARD</span>
          <span class="trip-route">{{ searchRequest.source }} To {{ searchRequest.destination }} On {{ searchRequest.journeyDate }}</span>
        </div>
        <button type="button" class="btn-modify" (click)="modifySearch()">MODIFY SEARCH</button>
      </div>
      
      <div class="stats-row">
        <div class="stat">
          <span class="stat-label">Total Buses Found:</span>
          <span class="stat-value">{{ availableBuses.length }}</span>
        </div>
        <div class="stat">
          <span class="stat-label">Total Operators Found:</span>
          <span class="stat-value">{{ getUniqueOperators() }}</span>
        </div>
        <div class="stat">
          <span class="stat-label">Total Seats Available:</span>
          <span class="stat-value">{{ getTotalSeats() }}</span>
        </div>
      </div>
    </div>

    <!-- Sort and Filter Options -->
    <div class="sort-filter-bar">
      <div class="sort-section">
        <span class="sort-label">SORT BY</span>
        <button class="sort-btn" (click)="sortBy('departure')">DEPARTURE TIME ⬆</button>
        <button class="sort-btn" (click)="sortBy('seats')">AVAILABLE SEATS ⬇</button>
        <button class="sort-btn" (click)="sortBy('fare')">FARE ⬆</button>
        <button class="sort-btn" (click)="sortBy('special')">SPECIAL OFFERS ⬇</button>
      </div>
      <button class="filter-btn">FILTER BY</button>
    </div>

    <!-- Bus Cards -->
    <div class="bus-list-container">
      <div *ngFor="let bus of availableBuses" class="bus-card-new">
        <div class="card-left">
          <div class="bus-company">
            <h3 class="company-name">{{ bus.busName }}</h3>
            <p class="bus-number">{{ bus.busNumber }}</p>
            <div class="amenities-badge">
              <span class="badge">{{ bus.busType }}</span>
            </div>
            <p class="cancellation-policy">Cancellation policy</p>
          </div>
        </div>

        <div class="card-middle">
          <div class="journey-segment">
            <div class="journey-left">
              <p class="label">Starting</p>
              <p class="time">{{ formatTime(bus.departureTime) }}</p>
              <p class="location">{{ searchRequest.source }}</p>
            </div>
            
            <div class="bus-icon-section">
              <i class="fas fa-bus bus-icon"></i>
              <p class="seats-info">Seats Left: <span class="seats-count">{{ bus.availableSeats }}</span></p>
            </div>

            <div class="journey-right">
              <p class="label">Arrival</p>
              <p class="time">{{ formatTime(bus.arrivalTime) }}</p>
              <p class="location">{{ searchRequest.destination }}</p>
            </div>
          </div>
        </div>

        <div class="card-right">
          <div class="special-offer">NO EXTRA CHARGE</div>
          <div class="price-section">
            <span class="currency">৳</span><span class="price-value">{{ bus.price }}</span>
          </div>
          <button class="btn-view-seats" (click)="selectBus(bus)">VIEW SEATS</button>
        </div>
      </div>
    </div>
  </div>

  <app-booking 
    *ngIf="selectedBus" 
    [selectedBus]="selectedBus"
    (bookingComplete)="onBookingComplete()"
    (bookingCancelled)="cancelSelection()">
  </app-booking>
</div>
